{"version":3,"file":"index.esm.js","sources":["../src/utils/generateId.ts","../src/utils/dev.ts","../src/utils/LocationHistory.ts","../src/ReactRouter/ViewStacks.ts","../src/ReactRouter/RouteManagerContext.ts","../src/ReactRouter/View.tsx","../src/ReactRouter/ViewTransitionManager.tsx","../src/ReactRouter/StackManager.tsx","../src/ReactRouter/NavManager.tsx","../src/ReactRouter/Router.tsx","../src/ReactRouter/IonReactRouter.tsx","../src/ReactRouter/IonReactHashRouter.tsx","../src/ReactRouter/IonReactMemoryRouter.tsx"],"sourcesContent":["let count = 0;\n\nexport const generateId = () => (count++).toString();\n","export const isDevMode = () => {\n  return process && process.env && process.env.NODE_ENV === 'development';\n};\n\nexport const deprecationWarning = (message: string) => {\n  if (isDevMode()) {\n    console.warn(message);\n  }\n};\n","import { Location as HistoryLocation } from 'history';\n\nconst RESTRICT_SIZE = 25;\n\nexport class LocationHistory {\n  private locationHistory: HistoryLocation[] = [];\n\n  add(location: HistoryLocation) {\n    this.locationHistory.push(location);\n    if (this.locationHistory.length > RESTRICT_SIZE) {\n      this.locationHistory.splice(0, 10);\n    }\n  }\n\n  pop() {\n    this.locationHistory.pop();\n  }\n\n  replace(location: HistoryLocation) {\n    this.locationHistory.pop();\n    this.locationHistory.push(location);\n  }\n\n  clear() {\n    this.locationHistory = [];\n  }\n\n  findLastLocationByUrl(url: string) {\n    for (let i = this.locationHistory.length - 1; i >= 0; i--) {\n      const location = this.locationHistory[i];\n      if (location.pathname.toLocaleLowerCase() === url.toLocaleLowerCase()) {\n        return location;\n      }\n    }\n    return undefined;\n  }\n\n  previous() {\n    return this.locationHistory[this.locationHistory.length - 2];\n  }\n\n  current() {\n    return this.locationHistory[this.locationHistory.length - 1];\n  }\n}\n","import { Location as HistoryLocation } from 'history';\nimport { matchPath } from 'react-router-dom';\n\nimport { IonRouteData } from './IonRouteData';\nimport { ViewItem } from './ViewItem';\n\nexport interface ViewStack {\n  id: string;\n  views: ViewItem[];\n}\n\n/**\n * The holistic view of all the Routes configured for an application inside of an IonRouterOutlet.\n */\nexport class ViewStacks {\n  private viewStacks: { [key: string]: ViewStack | undefined; } = {};\n\n  get(key: string) {\n    return this.viewStacks[key];\n  }\n\n  set(key: string, viewStack: ViewStack) {\n    this.viewStacks[key] = viewStack;\n  }\n\n  getKeys() {\n    return Object.keys(this.viewStacks);\n  }\n\n  delete(key: string) {\n    delete this.viewStacks[key];\n  }\n\n  findViewInfoByLocation(location: HistoryLocation, viewKey: string) {\n    let view: ViewItem<IonRouteData> | undefined;\n    let match: IonRouteData['match'] | null | undefined;\n    let viewStack: ViewStack | undefined;\n\n    viewStack = this.viewStacks[viewKey];\n    if (viewStack) {\n      viewStack.views.some(matchView);\n\n      if (!view) {\n        viewStack.views.some(r => {\n          // try to find a route that doesn't have a path or from prop, that will be our not found route\n          if (!r.routeData.childProps.path && !r.routeData.childProps.from) {\n            match = {\n              path: location.pathname,\n              url: location.pathname,\n              isExact: true,\n              params: {}\n            };\n            view = r;\n            return true;\n          }\n          return false;\n        });\n      }\n    }\n\n    return { view, viewStack, match };\n\n    function matchView(v: ViewItem) {\n      const matchProps = {\n        exact: v.routeData.childProps.exact,\n        path: v.routeData.childProps.path || v.routeData.childProps.from,\n        component: v.routeData.childProps.component\n      };\n      const myMatch: IonRouteData['match'] | null | undefined = matchPath(location.pathname, matchProps);\n      if (myMatch) {\n        view = v;\n        match = myMatch;\n        return true;\n      }\n      return false;\n    }\n\n  }\n\n  findViewInfoById(id = '') {\n    let view: ViewItem<IonRouteData> | undefined;\n    let viewStack: ViewStack | undefined;\n    const keys = this.getKeys();\n    keys.some(key => {\n      const vs = this.viewStacks[key];\n      view = vs!.views.find(x => x.id === id);\n      if (view) {\n        viewStack = vs;\n        return true;\n      } else {\n        return false;\n      }\n    });\n    return { view, viewStack };\n  }\n\n}\n","import React, { ReactNode } from 'react';\n\nimport { ViewStacks } from './ViewStacks';\n\nexport interface RouteManagerContextState {\n  syncView: (page: HTMLElement, viewId: string) => void;\n  syncRoute: (id: string, route: any) => void;\n  hideView: (viewId: string) => void;\n  viewStacks: ViewStacks;\n  setupIonRouter: (id: string, children: ReactNode, routerOutlet: HTMLIonRouterOutletElement) => void;\n  removeViewStack: (stack: string) => void;\n  getRoute: (id: string) => any;\n}\n\nexport const RouteManagerContext = /*@__PURE__*/React.createContext<RouteManagerContextState>({\n  viewStacks: new ViewStacks(),\n  syncView: () => { navContextNotFoundError(); },\n  syncRoute: () => { navContextNotFoundError(); },\n  hideView: () => { navContextNotFoundError(); },\n  setupIonRouter: () => Promise.reject(navContextNotFoundError()),\n  removeViewStack: () => { navContextNotFoundError(); },\n  getRoute: () => { navContextNotFoundError(); }\n});\n\nfunction navContextNotFoundError() {\n  console.error('IonReactRouter not found, did you add it to the app?');\n}\n","import { IonLifeCycleContext, NavContext } from '@ionic/react';\nimport React from 'react';\n\nimport { isDevMode } from '../utils';\n\nimport { ViewItem } from './ViewItem';\n\ninterface ViewProps extends React.HTMLAttributes<HTMLElement> {\n  onViewSync: (page: HTMLElement, viewId: string) => void;\n  onHideView: (viewId: string) => void;\n  view: ViewItem;\n  route: any;\n}\n\n/**\n * The View component helps manage the IonPage's lifecycle and registration\n */\nexport class View extends React.Component<ViewProps, {}> {\n  context!: React.ContextType<typeof IonLifeCycleContext>;\n  ionPage?: HTMLElement;\n\n  componentWillUnmount() {\n    if (this.ionPage) {\n      this.ionPage.removeEventListener('ionViewWillEnter', this.ionViewWillEnterHandler.bind(this));\n      this.ionPage.removeEventListener('ionViewDidEnter', this.ionViewDidEnterHandler.bind(this));\n      this.ionPage.removeEventListener('ionViewWillLeave', this.ionViewWillLeaveHandler.bind(this));\n      this.ionPage.removeEventListener('ionViewDidLeave', this.ionViewDidLeaveHandler.bind(this));\n    }\n  }\n\n  ionViewWillEnterHandler() {\n    this.context.ionViewWillEnter();\n  }\n\n  ionViewDidEnterHandler() {\n    this.context.ionViewDidEnter();\n  }\n\n  ionViewWillLeaveHandler() {\n    this.context.ionViewWillLeave();\n  }\n\n  ionViewDidLeaveHandler() {\n    this.context.ionViewDidLeave();\n  }\n\n  registerIonPage(page: HTMLElement) {\n    this.ionPage = page;\n    this.ionPage.addEventListener('ionViewWillEnter', this.ionViewWillEnterHandler.bind(this));\n    this.ionPage.addEventListener('ionViewDidEnter', this.ionViewDidEnterHandler.bind(this));\n    this.ionPage.addEventListener('ionViewWillLeave', this.ionViewWillLeaveHandler.bind(this));\n    this.ionPage.addEventListener('ionViewDidLeave', this.ionViewDidLeaveHandler.bind(this));\n    this.ionPage.classList.add('ion-page-invisible');\n    if (isDevMode()) {\n      this.ionPage.setAttribute('data-view-id', this.props.view.id);\n    }\n    this.props.onViewSync(page, this.props.view.id);\n  }\n\n  render() {\n    return (\n      <NavContext.Consumer>\n        {value => {\n          const newProvider = {\n            ...value,\n            registerIonPage: this.registerIonPage.bind(this)\n          };\n\n          return (\n            <NavContext.Provider value={newProvider}>\n              {this.props.children}\n            </NavContext.Provider>\n          );\n\n        }}\n      </NavContext.Consumer>\n    );\n  }\n\n  static get contextType() {\n    return IonLifeCycleContext;\n  }\n}\n","import { DefaultIonLifeCycleContext, IonLifeCycleContext } from '@ionic/react';\nimport React from 'react';\n\nimport { RouteManagerContext } from './RouteManagerContext';\n\ninterface ViewTransitionManagerProps {\n  id: string;\n  mount: boolean;\n}\n\ninterface ViewTransitionManagerState {\n  show: boolean;\n}\n\n/**\n * Manages the View's DOM lifetime by keeping it around long enough to complete page transitions before removing it.\n */\nexport class ViewTransitionManager extends React.Component<ViewTransitionManagerProps, ViewTransitionManagerState> {\n  ionLifeCycleContext = new DefaultIonLifeCycleContext();\n  _isMounted = false;\n  context!: React.ContextType<typeof RouteManagerContext>;\n\n  constructor(props: ViewTransitionManagerProps) {\n    super(props);\n    this.state = {\n      show: true\n    };\n\n    this.ionLifeCycleContext.onComponentCanBeDestroyed(() => {\n      if (!this.props.mount) {\n        if (this._isMounted) {\n          this.setState({\n            show: false\n          }, () => {\n            this.context.hideView(this.props.id);\n          });\n        }\n      }\n    });\n  }\n\n  componentDidMount() {\n    this._isMounted = true;\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  render() {\n    const { show } = this.state;\n    return (\n      <IonLifeCycleContext.Provider value={this.ionLifeCycleContext}>\n        {show && this.props.children}\n      </IonLifeCycleContext.Provider>\n    );\n  }\n\n  static get contextType() {\n    return RouteManagerContext;\n  }\n}\n","import React from 'react';\n\nimport { generateId, isDevMode } from '../utils';\n\nimport { RouteManagerContext, RouteManagerContextState } from './RouteManagerContext';\nimport { View } from './View';\nimport { ViewItem } from './ViewItem';\nimport { ViewTransitionManager } from './ViewTransitionManager';\n\ninterface StackManagerProps {\n  id?: string;\n  routeManager: RouteManagerContextState;\n  children?: React.ReactNode;\n}\n\ninterface StackManagerState { }\n\nclass StackManagerInner extends React.Component<StackManagerProps, StackManagerState> {\n  routerOutletEl: React.RefObject<HTMLIonRouterOutletElement> = React.createRef();\n  id: string;\n\n  constructor(props: StackManagerProps) {\n    super(props);\n    this.id = this.props.id || generateId();\n    this.handleViewSync = this.handleViewSync.bind(this);\n    this.handleHideView = this.handleHideView.bind(this);\n    this.state = {};\n  }\n\n  componentDidMount() {\n    this.props.routeManager.setupIonRouter(this.id, this.props.children, this.routerOutletEl.current!);\n  }\n\n  static getDerivedStateFromProps(props: StackManagerProps, state: StackManagerState) {\n    props.routeManager.syncRoute('', props.children);\n    return state;\n  }\n\n  componentWillUnmount() {\n    this.props.routeManager.removeViewStack(this.id);\n  }\n\n  handleViewSync(page: HTMLElement, viewId: string) {\n    this.props.routeManager.syncView(page, viewId);\n  }\n\n  handleHideView(viewId: string) {\n    this.props.routeManager.hideView(viewId);\n  }\n\n  renderChild(item: ViewItem, route: any) {\n    const component = React.cloneElement(route, {\n      computedMatch: item.routeData.match\n    });\n    return component;\n  }\n\n  render() {\n    const routeManager = this.props.routeManager;\n    const viewStack = routeManager.viewStacks.get(this.id);\n    const views = (viewStack || { views: [] }).views.filter(x => x.show);\n    const ionRouterOutlet = React.Children.only(this.props.children) as React.ReactElement;\n    const childElements = views.map(view => {\n      const route = routeManager.getRoute(view.routeId);\n      return (\n        <ViewTransitionManager\n          id={view.id}\n          key={view.key}\n          mount={view.mount}\n        >\n          <View\n            onViewSync={this.handleViewSync}\n            onHideView={this.handleHideView}\n            view={view}\n            route={route}\n          >\n            {this.renderChild(view, route)}\n          </View>\n        </ViewTransitionManager>\n      );\n    });\n\n    const elementProps: any = {\n      ref: this.routerOutletEl\n    };\n\n    if (ionRouterOutlet.props.forwardedRef) {\n      ionRouterOutlet.props.forwardedRef.current = this.routerOutletEl;\n    }\n\n    if (isDevMode()) {\n      elementProps['data-stack-id'] = this.id;\n    }\n\n    const routerOutletChild = React.cloneElement(ionRouterOutlet, elementProps, childElements);\n\n    return routerOutletChild;\n  }\n}\n\nconst withContext = (Component: any) => {\n  return (props: any) => (\n    <RouteManagerContext.Consumer>\n      {context => <Component {...props} routeManager={context} />}\n    </RouteManagerContext.Consumer>\n  );\n};\n\nexport const StackManager = withContext(StackManagerInner);\n","import { RouterDirection } from '@ionic/core';\nimport { NavContext, NavContextState } from '@ionic/react';\nimport { Location as HistoryLocation, UnregisterCallback } from 'history';\nimport React from 'react';\nimport { RouteComponentProps } from 'react-router-dom';\n\nimport { IonRouteAction } from './IonRouteAction';\nimport { StackManager } from './StackManager';\n\ninterface NavManagerProps extends RouteComponentProps {\n  onNavigateBack: (defaultHref?: string) => void;\n  onNavigate: (ionRouteAction: IonRouteAction, path: string, state?: any) => void;\n}\n\nexport class NavManager extends React.Component<NavManagerProps, NavContextState> {\n\n  listenUnregisterCallback: UnregisterCallback | undefined;\n\n  constructor(props: NavManagerProps) {\n    super(props);\n    this.state = {\n      goBack: this.goBack.bind(this),\n      hasIonicRouter: () => true,\n      navigate: this.navigate.bind(this),\n      getStackManager: this.getStackManager.bind(this),\n      getPageManager: this.getPageManager.bind(this),\n      currentPath: this.props.location.pathname,\n      registerIonPage: () => { return; } // overridden in View for each IonPage\n    };\n\n    this.listenUnregisterCallback = this.props.history.listen((location: HistoryLocation) => {\n      this.setState({\n        currentPath: location.pathname\n      });\n    });\n\n    if (document) {\n      document.addEventListener('ionBackButton', (e: any) => {\n        e.detail.register(0, () => {\n          this.props.history.goBack();\n        });\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.listenUnregisterCallback) {\n      this.listenUnregisterCallback();\n    }\n  }\n\n  goBack(defaultHref?: string) {\n    this.props.onNavigateBack(defaultHref);\n  }\n\n  navigate(path: string, direction?: RouterDirection | 'none', ionRouteAction: IonRouteAction = 'push') {\n    this.props.onNavigate(ionRouteAction, path, direction);\n  }\n\n  getPageManager() {\n    return (children: any) => children;\n  }\n\n  getStackManager() {\n    return StackManager;\n  }\n\n  render() {\n    return (\n      <NavContext.Provider value={this.state}>\n        {this.props.children}\n      </NavContext.Provider>\n    );\n  }\n\n}\n","import { NavDirection } from '@ionic/core';\nimport { RouterDirection, getConfig } from '@ionic/react';\nimport { Action as HistoryAction, Location as HistoryLocation, UnregisterCallback } from 'history';\nimport React from 'react';\nimport { RouteComponentProps, matchPath, withRouter } from 'react-router-dom';\n\nimport { generateId, isDevMode } from '../utils';\nimport { LocationHistory } from '../utils/LocationHistory';\n\nimport { IonRouteAction } from './IonRouteAction';\nimport { IonRouteData } from './IonRouteData';\nimport { NavManager } from './NavManager';\nimport { RouteManagerContext, RouteManagerContextState } from './RouteManagerContext';\nimport { ViewItem } from './ViewItem';\nimport { ViewStack, ViewStacks } from './ViewStacks';\n\nexport interface LocationState {\n  direction?: RouterDirection;\n  action?: IonRouteAction;\n}\n\ninterface RouteManagerProps extends RouteComponentProps<{}, {}, LocationState> {\n  location: HistoryLocation<LocationState>;\n}\n\ninterface RouteManagerState extends RouteManagerContextState {\n  location?: HistoryLocation<LocationState>;\n  action?: IonRouteAction;\n}\n\nexport class RouteManager extends React.Component<RouteManagerProps, RouteManagerState> {\n  listenUnregisterCallback: UnregisterCallback | undefined;\n  activeIonPageId?: string;\n  currentIonRouteAction?: IonRouteAction;\n  currentRouteDirection?: RouterDirection;\n  locationHistory = new LocationHistory();\n  routes: { [key: string]: React.ReactElement<any>; } = {};\n  ionPageElements: { [key: string]: HTMLElement; } = {};\n  routerOutlets: { [key: string]: HTMLIonRouterOutletElement; } = {};\n  firstRender = true;\n\n  constructor(props: RouteManagerProps) {\n    super(props);\n    this.listenUnregisterCallback = this.props.history.listen(this.historyChange.bind(this));\n    this.handleNavigate = this.handleNavigate.bind(this);\n    this.navigateBack = this.navigateBack.bind(this);\n    this.state = {\n      viewStacks: new ViewStacks(),\n      hideView: this.hideView.bind(this),\n      setupIonRouter: this.setupIonRouter.bind(this),\n      removeViewStack: this.removeViewStack.bind(this),\n      syncView: this.syncView.bind(this),\n      syncRoute: this.syncRoute.bind(this),\n      getRoute: this.getRoute.bind(this)\n    };\n\n    this.locationHistory.add({\n      hash: window.location.hash,\n      key: generateId(),\n      pathname: window.location.pathname,\n      search: window.location.search,\n      state: {}\n    });\n  }\n\n  componentDidUpdate(_prevProps: RouteComponentProps, prevState: RouteManagerState) {\n    // Trigger a page change if the location or action is different\n    if (this.state.location && prevState.location !== this.state.location || prevState.action !== this.state.action) {\n      const viewStacks = Object.assign(new ViewStacks(), this.state.viewStacks);\n      this.setActiveView(this.state.location!, this.state.action!, viewStacks);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.listenUnregisterCallback) {\n      this.listenUnregisterCallback();\n    }\n  }\n\n  getRoute(id: string) {\n    return this.routes[id];\n  }\n\n  hideView(viewId: string) {\n    const viewStacks = Object.assign(new ViewStacks(), this.state.viewStacks);\n    const { view } = viewStacks.findViewInfoById(viewId);\n    if (view) {\n      view.show = false;\n      view.isIonRoute = false;\n      view.prevId = undefined;\n      view.key = generateId();\n      delete this.ionPageElements[view.id];\n      this.setState({\n        viewStacks\n      });\n    }\n  }\n\n  historyChange(location: HistoryLocation<LocationState>, action: HistoryAction) {\n    const ionRouteAction = this.currentIonRouteAction === 'pop' ? 'pop' : action.toLowerCase() as IonRouteAction;\n    let direction = this.currentRouteDirection;\n\n    if (ionRouteAction === 'push') {\n      this.locationHistory.add(location);\n    } else if (ionRouteAction === 'pop') {\n      this.locationHistory.pop();\n      direction = direction || 'back';\n    } else if (ionRouteAction === 'replace') {\n      this.locationHistory.replace(location);\n      direction = 'none';\n    }\n\n    if (direction === 'root') {\n      this.locationHistory.clear();\n      this.locationHistory.add(location);\n    }\n\n    location.state = location.state || { direction };\n    this.setState({\n      location,\n      action: ionRouteAction as IonRouteAction\n    });\n    this.currentRouteDirection = undefined;\n    this.currentIonRouteAction = undefined;\n  }\n\n  setActiveView(location: HistoryLocation<LocationState>, action: IonRouteAction, viewStacks: ViewStacks) {\n    let direction: RouterDirection | undefined = (location.state && location.state.direction) || 'forward';\n    let leavingView: ViewItem | undefined;\n    const viewStackKeys = viewStacks.getKeys();\n    let shouldTransitionPage = false;\n    let leavingViewHtml: string | undefined;\n\n    viewStackKeys.forEach(key => {\n      const { view: enteringView, viewStack: enteringViewStack, match } = viewStacks.findViewInfoByLocation(location, key);\n      if (!enteringView || !enteringViewStack) {\n        return;\n      }\n\n      leavingView = viewStacks.findViewInfoById(this.activeIonPageId).view;\n\n      if (enteringView.isIonRoute) {\n        enteringView.show = true;\n        enteringView.mount = true;\n        enteringView.routeData.match = match!;\n        shouldTransitionPage = true;\n\n        this.activeIonPageId = enteringView.id;\n\n        if (leavingView) {\n          if (action === 'push' && direction === 'forward') {\n            /**\n             * If the page is being pushed into the stack by another view,\n             * record the view that originally directed to the new view for back button purposes.\n             */\n            enteringView.prevId = leavingView.id;\n          } else {\n            leavingView.mount = false;\n            this.removeOrphanedViews(enteringView, enteringViewStack);\n          }\n\n          leavingViewHtml = enteringView.id === leavingView.id ? this.ionPageElements[leavingView.id].outerHTML : undefined;\n        } else {\n          // If there is not a leavingView, then we shouldn't provide a direction\n          direction = undefined;\n        }\n\n      } else {\n        enteringView.show = true;\n        enteringView.mount = true;\n        enteringView.routeData.match = match!;\n      }\n\n    });\n\n    if (leavingView) {\n      if (!leavingView.isIonRoute) {\n        leavingView.mount = false;\n        leavingView.show = false;\n      }\n    }\n\n    this.setState({\n      viewStacks\n    }, () => {\n      if (shouldTransitionPage) {\n        const { view: enteringView, viewStack } = this.state.viewStacks.findViewInfoById(this.activeIonPageId);\n        if (enteringView && viewStack) {\n          const enteringEl = this.ionPageElements[enteringView.id];\n          const leavingEl = leavingView && this.ionPageElements[leavingView.id];\n          if (enteringEl) {\n            let navDirection: NavDirection | undefined;\n            if (leavingEl && leavingEl.innerHTML === '') {\n              // Don't animate from an empty view\n              navDirection = undefined;\n            } else if (direction === 'none' || direction === 'root') {\n              navDirection = undefined;\n            } else {\n              navDirection = direction;\n            }\n            const shouldGoBack = !!enteringView.prevId;\n            const routerOutlet = this.routerOutlets[viewStack.id];\n            this.commitView(\n              enteringEl!,\n              leavingEl!,\n              routerOutlet,\n              navDirection,\n              shouldGoBack,\n              leavingViewHtml);\n          } else if (leavingEl) {\n            leavingEl.classList.add('ion-page-hidden');\n            leavingEl.setAttribute('aria-hidden', 'true');\n          }\n        }\n\n        // Warn if an IonPage was not eventually rendered in Dev Mode\n        if (isDevMode()) {\n          if (enteringView && enteringView.routeData.match!.url !== location.pathname) {\n            setTimeout(() => {\n              const { view } = this.state.viewStacks.findViewInfoById(this.activeIonPageId);\n              if (view!.routeData.match!.url !== location.pathname) {\n                console.warn('No IonPage was found to render. Make sure you wrap your page with an IonPage component.');\n              }\n            }, 100);\n          }\n        }\n      }\n    });\n  }\n\n  removeOrphanedViews(view: ViewItem, viewStack: ViewStack) {\n    // Note: This technique is a bit wonky for views that reference each other and get into a circular loop.\n    // It can still remove a view that probably shouldn't be.\n    const viewsToRemove = viewStack.views.filter(v => v.prevId === view.id);\n    viewsToRemove.forEach(v => {\n      // Don't remove if view is currently active\n      if (v.id !== this.activeIonPageId) {\n        this.removeOrphanedViews(v, viewStack);\n\n        // If view is not currently visible, go ahead and remove it from DOM\n        const page = this.ionPageElements[v.id];\n        if (page.classList.contains('ion-page-hidden')) {\n          v.show = false;\n          v.isIonRoute = false;\n          v.prevId = undefined;\n          v.key = generateId();\n          delete this.ionPageElements[v.id];\n        }\n        v.mount = false;\n      }\n    });\n  }\n\n  setupIonRouter(id: string, children: any, routerOutlet: HTMLIonRouterOutletElement) {\n    const views: ViewItem[] = [];\n    let activeId: string | undefined;\n    const ionRouterOutlet = React.Children.only(children) as React.ReactElement;\n    let foundMatch = false;\n    React.Children.forEach(ionRouterOutlet.props.children, (child: React.ReactElement) => {\n      const routeId = generateId();\n      this.routes[routeId] = child;\n      views.push(createViewItem(child, routeId, this.props.history.location));\n    });\n\n    if (!foundMatch) {\n      const notFoundRoute = views.find(r => {\n        // try to find a route that doesn't have a path or from prop, that will be our not found route\n        return !r.routeData.childProps.path && !r.routeData.childProps.from;\n      });\n      if (notFoundRoute) {\n        notFoundRoute.show = true;\n      }\n    }\n\n    this.registerViewStack(id, activeId, views, routerOutlet, this.props.location);\n\n    function createViewItem(child: React.ReactElement<any>, routeId: string, location: HistoryLocation) {\n      const viewId = generateId();\n      const key = generateId();\n\n      // const route = child;\n      const matchProps = {\n        exact: child.props.exact,\n        path: child.props.path || child.props.from,\n        component: child.props.component\n      };\n      const match: IonRouteData['match'] = matchPath(location.pathname, matchProps);\n      const view: ViewItem<IonRouteData> = {\n        id: viewId,\n        key,\n        routeData: {\n          match,\n          childProps: child.props\n        },\n        routeId,\n        mount: true,\n        show: !!match,\n        isIonRoute: false\n      };\n      if (match && view.isIonRoute) {\n        activeId = viewId;\n      }\n      if (!foundMatch && match) {\n        foundMatch = true;\n      }\n      return view;\n    }\n  }\n\n  registerViewStack(stack: string, activeId: string | undefined, stackItems: ViewItem[], routerOutlet: HTMLIonRouterOutletElement, _location: HistoryLocation) {\n    this.setState(prevState => {\n      const prevViewStacks = Object.assign(new ViewStacks(), prevState.viewStacks);\n      const newStack: ViewStack = {\n        id: stack,\n        views: stackItems\n      };\n      this.routerOutlets[stack] = routerOutlet;\n      if (activeId) {\n        this.activeIonPageId = activeId;\n      }\n      prevViewStacks.set(stack, newStack);\n      return {\n        viewStacks: prevViewStacks\n      };\n    }, () => {\n      this.setupRouterOutlet(routerOutlet);\n    });\n  }\n\n  async setupRouterOutlet(routerOutlet: HTMLIonRouterOutletElement) {\n\n    const canStart = () => {\n      const config = getConfig();\n      const swipeEnabled = config && config.get('swipeBackEnabled', routerOutlet.mode === 'ios');\n      if (swipeEnabled) {\n        const { view } = this.state.viewStacks.findViewInfoById(this.activeIonPageId);\n        return !!(view && view.prevId);\n      } else {\n        return false;\n      }\n    };\n\n    const onStart = () => {\n      this.navigateBack();\n    };\n    routerOutlet.swipeHandler = {\n      canStart,\n      onStart,\n      onEnd: _shouldContinue => true\n    };\n  }\n\n  removeViewStack(stack: string) {\n    const viewStacks = Object.assign(new ViewStacks(), this.state.viewStacks);\n    viewStacks.delete(stack);\n    this.setState({\n      viewStacks\n    });\n  }\n\n  syncView(page: HTMLElement, viewId: string) {\n    const viewStacks = Object.assign(new ViewStacks(), this.state.viewStacks);\n    const { view } = viewStacks.findViewInfoById(viewId);\n    if (view) {\n      view.isIonRoute = true;\n      this.ionPageElements[view.id] = page;\n      this.setActiveView(this.state.location || this.props.location, this.state.action!, viewStacks);\n    }\n  }\n\n  syncRoute(_id: string, routerOutlet: any) {\n    const ionRouterOutlet = React.Children.only(routerOutlet) as React.ReactElement;\n\n    React.Children.forEach(ionRouterOutlet.props.children, (child: React.ReactElement) => {\n      for (const routeKey in this.routes) {\n        const route = this.routes[routeKey];\n        if (typeof route.props.path !== 'undefined' && route.props.path === (child.props.path || child.props.from)) {\n          this.routes[routeKey] = child;\n        }\n      }\n    });\n  }\n\n  private async commitView(enteringEl: HTMLElement, leavingEl: HTMLElement, ionRouterOutlet: HTMLIonRouterOutletElement, direction?: NavDirection, showGoBack?: boolean, leavingViewHtml?: string) {\n    if (!this.firstRender) {\n\n      if (!('componentOnReady' in ionRouterOutlet)) {\n        await waitUntilRouterOutletReady(ionRouterOutlet);\n      }\n\n      if ((enteringEl === leavingEl) && direction && leavingViewHtml) {\n        // If a page is transitioning to another version of itself\n        // we clone it so we can have an animation to show\n        const newLeavingElement = clonePageElement(leavingViewHtml);\n        ionRouterOutlet.appendChild(newLeavingElement);\n        await ionRouterOutlet.commit(enteringEl, newLeavingElement, {\n          deepWait: true,\n          duration: direction === undefined ? 0 : undefined,\n          direction,\n          showGoBack,\n          progressAnimation: false\n        });\n        ionRouterOutlet.removeChild(newLeavingElement);\n      } else {\n        await ionRouterOutlet.commit(enteringEl, leavingEl, {\n          deepWait: true,\n          duration: direction === undefined ? 0 : undefined,\n          direction,\n          showGoBack,\n          progressAnimation: false\n        });\n      }\n\n      if (leavingEl && (enteringEl !== leavingEl)) {\n        /** add hidden attributes */\n        leavingEl.classList.add('ion-page-hidden');\n        leavingEl.setAttribute('aria-hidden', 'true');\n      }\n    } else {\n      enteringEl.classList.remove('ion-page-invisible');\n      enteringEl.style.zIndex = '101';\n      enteringEl.dispatchEvent(new Event('ionViewWillEnter'));\n      enteringEl.dispatchEvent(new Event('ionViewDidEnter'));\n      this.firstRender = false;\n    }\n  }\n\n  handleNavigate(ionRouteAction: IonRouteAction, path: string, direction?: RouterDirection) {\n    this.currentIonRouteAction = ionRouteAction;\n    switch (ionRouteAction) {\n      case 'push':\n        this.currentRouteDirection = direction;\n        this.props.history.push(path);\n        break;\n      case 'pop':\n        this.currentRouteDirection = direction || 'back';\n        this.props.history.replace(path);\n        break;\n      case 'replace':\n        this.currentRouteDirection = 'none';\n        this.props.history.replace(path);\n        break;\n    }\n  }\n\n  navigateBack(defaultHref?: string) {\n    const { view: leavingView } = this.state.viewStacks.findViewInfoById(this.activeIonPageId);\n    if (leavingView) {\n      if (leavingView.id === leavingView.prevId) {\n        const previousLocation = this.locationHistory.previous();\n        if (previousLocation) {\n          this.handleNavigate('pop', previousLocation.pathname + previousLocation.search);\n        } else {\n          defaultHref && this.handleNavigate('pop', defaultHref);\n        }\n      } else {\n        const { view: enteringView } = this.state.viewStacks.findViewInfoById(leavingView.prevId);\n        if (enteringView) {\n          const lastLocation = this.locationHistory.findLastLocationByUrl(enteringView.routeData.match!.url);\n          if (lastLocation) {\n            this.handleNavigate('pop', lastLocation.pathname + lastLocation.search);\n          } else {\n            this.handleNavigate('pop', enteringView.routeData.match!.url);\n          }\n        } else {\n          const currentLocation = this.locationHistory.previous();\n          if (currentLocation) {\n            this.handleNavigate('pop', currentLocation.pathname + currentLocation.search);\n          } else {\n            if (defaultHref) {\n              this.handleNavigate('pop', defaultHref);\n            }\n          }\n        }\n      }\n    } else {\n      if (defaultHref) {\n        this.handleNavigate('replace', defaultHref, 'back');\n      }\n    }\n  }\n\n  render() {\n    return (\n      <RouteManagerContext.Provider value={this.state}>\n        <NavManager\n          {...this.props}\n          onNavigateBack={this.navigateBack}\n          onNavigate={this.handleNavigate}\n        >\n          {this.props.children}\n        </NavManager>\n      </RouteManagerContext.Provider>\n    );\n  }\n}\n\nfunction clonePageElement(leavingViewHtml: string) {\n  const newEl = document.createElement('div');\n  newEl.innerHTML = leavingViewHtml;\n  newEl.classList.add('ion-page-hidden');\n  newEl.style.zIndex = '';\n  // Remove an existing back button so the new element doesn't get two of them\n  const ionBackButton = newEl.getElementsByTagName('ion-back-button');\n  if (ionBackButton[0]) {\n    ionBackButton[0].innerHTML = '';\n  }\n  return newEl.firstChild as HTMLElement;\n}\n\nasync function waitUntilRouterOutletReady(ionRouterOutlet: HTMLIonRouterElement) {\n  if ('componentOnReady' in ionRouterOutlet) {\n    return;\n  } else {\n    setTimeout(() => {\n      waitUntilRouterOutletReady(ionRouterOutlet);\n    }, 0);\n  }\n}\n\nexport const RouteManagerWithRouter = withRouter(RouteManager);\nRouteManagerWithRouter.displayName = 'RouteManager';\n","import React from 'react';\nimport { BrowserRouter, BrowserRouterProps } from 'react-router-dom';\n\nimport { RouteManagerWithRouter } from './Router';\n\nexport class IonReactRouter extends React.Component<BrowserRouterProps> {\n  render() {\n    const { children, ...props } = this.props;\n    return (\n      <BrowserRouter {...props}>\n        <RouteManagerWithRouter>{children}</RouteManagerWithRouter>\n      </BrowserRouter>\n    );\n  }\n}\n","import React from 'react';\nimport { HashRouter, HashRouterProps } from 'react-router-dom';\n\nimport { RouteManagerWithRouter } from './Router';\n\nexport class IonReactHashRouter extends React.Component<HashRouterProps> {\n  render() {\n    const { children, ...props } = this.props;\n    return (\n      <HashRouter {...props}>\n        <RouteManagerWithRouter>{children}</RouteManagerWithRouter>\n      </HashRouter>\n    );\n  }\n}\n","import { MemoryHistory } from 'history';\nimport React from 'react';\nimport { MemoryRouter, MemoryRouterProps, matchPath } from 'react-router';\n\nimport { LocationState, RouteManager } from './Router';\n\ninterface IonReactMemoryRouterProps extends MemoryRouterProps {\n  history: MemoryHistory<LocationState>;\n}\n\nexport class IonReactMemoryRouter extends React.Component<IonReactMemoryRouterProps> {\n  render() {\n    const { children, history, ...props } = this.props;\n    const match = matchPath(history.location.pathname, this.props);\n    return (\n      <MemoryRouter {...props}>\n        <RouteManager history={history} location={history.location} match={match!}>{children}</RouteManager>\n      </MemoryRouter>\n    );\n  }\n}\n"],"names":["matchPath"],"mappings":"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"}